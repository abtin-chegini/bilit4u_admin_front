# Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡â€ŒØ³Ø§Ø²ÛŒ ØµÙØ­Ù‡ Checkout

## Ø®Ù„Ø§ØµÙ‡ ØªØºÛŒÛŒØ±Ø§Øª

ÛŒÚ© ØµÙØ­Ù‡ Checkout Ú©Ø§Ù…Ù„ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯ Ú©Ù‡ Ø´Ø§Ù…Ù„ Û³ Ø¨Ø®Ø´ Ø§ØµÙ„ÛŒ Ø§Ø³Øª:

### Û±. Ø¨Ø®Ø´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³ÙØ± (TicketCardLg) 
- Ù†Ù…Ø§ÛŒØ´ Ú©Ø§Ù…Ù„ Ø¬Ø²Ø¦ÛŒØ§Øª Ø¨Ù„ÛŒØ·
- Ù…Ø³ÛŒØ±ØŒ Ø²Ù…Ø§Ù† Ø­Ø±Ú©ØªØŒ Ø²Ù…Ø§Ù† Ø±Ø³ÛŒØ¯Ù†
- Ø§Ù…Ú©Ø§Ù†Ø§Øª Ø§ØªÙˆØ¨ÙˆØ³
- Ù‚ÙˆØ§Ù†ÛŒÙ† Ø§Ø³ØªØ±Ø¯Ø§Ø¯

### Û². Ø¨Ø®Ø´ Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø³Ø§ÙØ±Ø§Ù† (Passenger Review)
- Ù„ÛŒØ³Øª ØªÙ…Ø§Ù… Ù…Ø³Ø§ÙØ±Ø§Ù† Ø¨Ø§ Ø¬Ø²Ø¦ÛŒØ§Øª
- Ù†Ù…Ø§ÛŒØ´ Ø´Ù…Ø§Ø±Ù‡ ØµÙ†Ø¯Ù„ÛŒ Ù‡Ø± Ù…Ø³Ø§ÙØ±
- Ù†Ù…Ø§ÛŒØ´ Ø¬Ù†Ø³ÛŒØª Ø¨Ø§ Ø±Ù†Ú¯â€ŒØ¨Ù†Ø¯ÛŒ Ù…Ù†Ø§Ø³Ø¨ (Ø¢Ø¨ÛŒ Ø¨Ø±Ø§ÛŒ Ø¢Ù‚Ø§ØŒ Ø³Ø¨Ø² Ø¨Ø±Ø§ÛŒ Ø®Ø§Ù†Ù…)
- Ù†Ù…Ø§ÛŒØ´ Ú©Ø¯ Ù…Ù„ÛŒ Ù…Ø³Ø§ÙØ±Ø§Ù†

### Û³. Ø¨Ø®Ø´ Ù¾Ø±Ø¯Ø§Ø®Øª (Payment Section)
- Ø®Ù„Ø§ØµÙ‡ Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§
- Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø®ÙˆØ¯Ú©Ø§Ø± Ù‚ÛŒÙ…Øª Ú©Ù„
- Ø±ÙˆØ´ Ù¾Ø±Ø¯Ø§Ø®Øª: **Ú¯ÛŒÙ Ù¾ÙˆÙ„**
- Ø¯Ú©Ù…Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ø§ Ù„ÙˆØ¯ÛŒÙ†Ú¯ Ø§Ø³ØªÛŒØª

## ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯Ù‡

1. **checkout.tsx** - Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª Ø§ØµÙ„ÛŒ Checkout
2. **README.md** - Ù…Ø³ØªÙ†Ø¯Ø§Øª Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª
3. **CheckoutPage.example.tsx** - Ù†Ù…ÙˆÙ†Ù‡â€ŒÙ‡Ø§ÛŒ ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡â€ŒØ³Ø§Ø²ÛŒ
4. **INTEGRATION.md** - Ø§ÛŒÙ† ÙØ§ÛŒÙ„ (Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡â€ŒØ³Ø§Ø²ÛŒ)

## Ù…Ø³ÛŒØ± ÙØ§ÛŒÙ„â€ŒÙ‡Ø§

```
/components/dashboard_admin_buy/pdp/previous/checkout/
  â”œâ”€â”€ checkout.tsx                    # Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª Ø§ØµÙ„ÛŒ
  â”œâ”€â”€ README.md                       # Ù…Ø³ØªÙ†Ø¯Ø§Øª
  â”œâ”€â”€ CheckoutPage.example.tsx        # Ù†Ù…ÙˆÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø¯ÛŒ
  â””â”€â”€ INTEGRATION.md                  # Ø§ÛŒÙ† ÙØ§ÛŒÙ„
```

## Ù†Ø­ÙˆÙ‡ ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§ Ø¬Ø±ÛŒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯

### Ú¯Ø²ÛŒÙ†Ù‡ Û±: Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² State Management (Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ)

```tsx
// Ø¯Ø± ÙØ§ÛŒÙ„ ÙˆØ§Ù„Ø¯ Ú©Ù‡ seat selection Ùˆ checkout Ø±Ø§ Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÛŒâ€ŒÚ©Ù†Ø¯
import { useState } from "react";
import BusReservationWithFlow from "@/components/dashboard_admin_buy/pdp/previous/bus_reservation/BusReservationWithFlow";
import { Checkout } from "@/components/dashboard_admin_buy/pdp/previous/checkout/checkout";

const ParentComponent = () => {
  const [step, setStep] = useState<"seats" | "checkout">("seats");
  const [ticketDetails, setTicketDetails] = useState(null);

  const handleContinueToCheckout = () => {
    setStep("checkout");
  };

  const handleBackToSeats = () => {
    setStep("seats");
  };

  return (
    <>
      {step === "seats" && (
        <BusReservationWithFlow
          onContinue={handleContinueToCheckout}
        />
      )}
      
      {step === "checkout" && ticketDetails && (
        <Checkout
          ticketDetails={ticketDetails}
          onBack={handleBackToSeats}
        />
      )}
    </>
  );
};
```

### Ú¯Ø²ÛŒÙ†Ù‡ Û²: Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Next.js Routing

```
Ø³Ø§Ø®ØªØ§Ø± Ù…Ø³ÛŒØ±Ù‡Ø§:
/ticket/[token]/[ticketId]/             # ØµÙØ­Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ ØµÙ†Ø¯Ù„ÛŒ
/ticket/[token]/[ticketId]/checkout     # ØµÙØ­Ù‡ Ú†Ú©â€ŒØ§ÙˆØª
```

#### Ø§ÛŒØ¬Ø§Ø¯ ÙØ§ÛŒÙ„ page.tsx Ø¨Ø±Ø§ÛŒ checkout:

```tsx
// app/ticket/[token]/[ticketId]/checkout/page.tsx
"use client";

import { useParams, useRouter } from "next/navigation";
import { Checkout } from "@/components/dashboard_admin_buy/pdp/previous/checkout/checkout";
import { useEffect, useState } from "react";

export default function CheckoutPage() {
  const params = useParams();
  const router = useRouter();
  const [ticketDetails, setTicketDetails] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const fetchTicketDetails = async () => {
      try {
        const response = await fetch(
          `https://api.bilit4u.com/admin/api/v1/tickets/${params.ticketId}`,
          {
            headers: {
              'Authorization': `Bearer ${params.token}`,
            }
          }
        );
        const data = await response.json();
        setTicketDetails(data.ticket);
      } catch (error) {
        console.error("Error:", error);
      } finally {
        setLoading(false);
      }
    };

    fetchTicketDetails();
  }, [params]);

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-[#0D5990]"></div>
      </div>
    );
  }

  return (
    <Checkout
      ticketDetails={ticketDetails}
      onBack={() => router.back()}
    />
  );
}
```

## ØªØºÛŒÛŒØ±Ø§Øª Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø² Ø¯Ø± BusReservationWithFlow

Ø¨Ø±Ø§ÛŒ Ø§ØªØµØ§Ù„ Ø¨Ù‡ ØµÙØ­Ù‡ checkoutØŒ Ú©Ø¯ Ø²ÛŒØ± Ø±Ø§ Ø¨Ù‡ ØªØ§Ø¨Ø¹ `handleContinueClick` Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯:

```tsx
const handleContinueClick = async () => {
  // ... Ú©Ø¯ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø±Ø§ÛŒ validation Ùˆ save ...
  
  const result = await savePassengerData();
  
  if (result.success) {
    toast({
      title: "Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø³Ø§ÙØ±Ø§Ù† Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯",
      description: "Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ ØµÙØ­Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª...",
    });

    setTimeout(() => {
      // Ú¯Ø²ÛŒÙ†Ù‡ Û±: Ø¨Ø§ state management
      if (onContinue) {
        onContinue(selectedSeats);
      }
      
      // ÛŒØ§ Ú¯Ø²ÛŒÙ†Ù‡ Û²: Ø¨Ø§ routing
      // router.push(`/ticket/${token}/${ticketId}/checkout`);
    }, 300);
  }
};
```

## Data Flow (Ø¬Ø±ÛŒØ§Ù† Ø¯Ø§Ø¯Ù‡)

```
1. Seat Selection Page (BusReservationWithFlow)
   â†“
   - User selects seats
   - User fills passenger details
   - User clicks "Ø°Ø®ÛŒØ±Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ùˆ Ø§Ø¯Ø§Ù…Ù‡"
   â†“
2. Save to Stores
   - Passengers â†’ PassengerStore
   - Seats â†’ TicketStore
   â†“
3. Navigate to Checkout
   â†“
4. Checkout Page
   - Reads from PassengerStore
   - Reads from TicketStore
   - Displays all information
   - User clicks "ØªØ§ÛŒÛŒØ¯ Ùˆ Ù¾Ø±Ø¯Ø§Ø®Øª"
   â†“
5. Payment Processing
   - POST to /admin/api/v1/admin/tickets/reserve
   - Payment from "Ú¯ÛŒÙ Ù¾ÙˆÙ„"
   â†“
6. Success/Failure
   - Success â†’ Navigate to ticket page
   - Failure â†’ Show error toast
```

## Required Stores

Ø§ÛŒÙ† Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª Ø§Ø² Zustand stores Ø²ÛŒØ± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯:

### TicketStore
```tsx
interface TicketStore {
  selectedSeats: Array<{
    id: number;
    seatNo: string | number;
    state: string;
  }>;
  ticketId: string;
  token: string;
}
```

### PassengerStore
```tsx
interface PassengerStore {
  passengers: StoredPassenger[];
  getSessionPassengers: () => StoredPassenger[];
}

interface StoredPassenger {
  id: number | string;
  seatId?: number;
  seatNo?: number | string;
  name: string;
  family: string;
  nationalId: string;
  gender: 1 | 2; // 1 = female, 2 = male
  birthDate: string;
}
```

## API Endpoint for Payment

```
POST https://api.bilit4u.com/admin/api/v1/admin/tickets/reserve

Headers:
  Authorization: Bearer {access_token}
  Content-Type: application/json

Body:
{
  "ticketId": "T12345",
  "requestToken": "abc123",
  "amount": 2500000,
  "passengers": [
    {
      "seatId": 1,
      "seatNo": "12",
      "firstName": "Ø¹Ù„ÛŒ",
      "lastName": "Ø§Ø­Ù…Ø¯ÛŒ",
      "nationalCode": "1234567890",
      "gender": true,  // true = male, false = female
      "dateOfBirth": "13800101"
    }
  ],
  "paymentMethod": "giftPool"
}

Response (Success):
{
  "success": true,
  "ticketId": "T12345",
  "message": "Ø¨Ù„ÛŒØ· Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø±Ø²Ø±Ùˆ Ø´Ø¯"
}

Response (Error):
{
  "success": false,
  "message": "Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª"
}
```

## Testing Checklist

Ù‚Ø¨Ù„ Ø§Ø² Ø§Ø³ØªÙ‚Ø±Ø§Ø±ØŒ Ù…ÙˆØ§Ø±Ø¯ Ø²ÛŒØ± Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯:

- [ ] ØµÙ†Ø¯Ù„ÛŒâ€ŒÙ‡Ø§ Ø¯Ø± TicketStore Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯
- [ ] Ù…Ø³Ø§ÙØ±Ø§Ù† Ø¯Ø± PassengerStore Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯
- [ ] Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ù„ÛŒØ· Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
- [ ] Ù„ÛŒØ³Øª Ù…Ø³Ø§ÙØ±Ø§Ù† Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
- [ ] Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯
- [ ] Ø¯Ú©Ù…Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª Ø¯Ø± Ø­Ø§Ù„Øª loading Ø¯Ø±Ø³Øª Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯
- [ ] Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø®Ø·Ø§ Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯
- [ ] Navigation Ø¨ÛŒÙ† ØµÙØ­Ø§Øª Ø¯Ø±Ø³Øª Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯
- [ ] Responsive design Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„ Ùˆ ØªØ¨Ù„Øª Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯
- [ ] Ù¾Ø±Ø¯Ø§Ø®Øª Ø§Ø² Ú¯ÛŒÙ Ù¾ÙˆÙ„ Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ´ÙˆØ¯

## Styling & Responsive

Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª Ø¨Ù‡ ØµÙˆØ±Øª Ú©Ø§Ù…Ù„ responsive Ø§Ø³Øª:

- **Desktop (lg+)**: Ù„ÛŒØ§ÙˆØª Û³ Ø³ØªÙˆÙ†ÛŒ Ø¨Ø§ sidebar Ú†Ø³Ø¨Ø§Ù† Ø¨Ø±Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª
- **Tablet (md)**: Ù„ÛŒØ§ÙˆØª Û² Ø³ØªÙˆÙ†ÛŒ
- **Mobile (sm)**: Ù„ÛŒØ§ÙˆØª ØªÚ© Ø³ØªÙˆÙ†ÛŒ Ø¨Ø§ Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¹Ù…ÙˆØ¯ÛŒ

## Ù†Ú©Ø§Øª Ù…Ù‡Ù…

1. **Authentication**: Ù‚Ø¨Ù„ Ø§Ø² ÙˆØ±ÙˆØ¯ Ø¨Ù‡ ØµÙØ­Ù‡ checkoutØŒ Ù…Ø·Ù…Ø¦Ù† Ø´ÙˆÛŒØ¯ Ú©Ø§Ø±Ø¨Ø± Ù„Ø§Ú¯ÛŒÙ† Ú©Ø±Ø¯Ù‡ Ø§Ø³Øª
2. **Data Validation**: Ù‚Ø¨Ù„ Ø§Ø² Ù†Ù…Ø§ÛŒØ´ ØµÙØ­Ù‡ØŒ Ù…Ø·Ù…Ø¦Ù† Ø´ÙˆÛŒØ¯ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù„Ø§Ø²Ù… Ø¯Ø± stores Ù…ÙˆØ¬ÙˆØ¯ Ø§Ø³Øª
3. **Error Handling**: ØªÙ…Ø§Ù… Ø®Ø·Ø§Ù‡Ø§ÛŒ Ø§Ø­ØªÙ…Ø§Ù„ÛŒ API Ø¨Ø§ toast Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
4. **Payment Method**: ÙÙ‚Ø· "Ú¯ÛŒÙ Ù¾ÙˆÙ„" Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯
5. **Session Management**: token Ø§Ø² localStorage Ø®ÙˆØ§Ù†Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯

## Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ùˆ Ø³ÙˆØ§Ù„Ø§Øª

Ø§Ú¯Ø± Ø³ÙˆØ§Ù„ÛŒ Ø¯Ø§Ø±ÛŒØ¯ ÛŒØ§ Ø¨Ù‡ Ú©Ù…Ú© Ù†ÛŒØ§Ø² Ø¯Ø§Ø±ÛŒØ¯ØŒ Ø¨Ù‡ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± Ù…Ø±Ø§Ø¬Ø¹Ù‡ Ú©Ù†ÛŒØ¯:

- **README.md**: Ù…Ø³ØªÙ†Ø¯Ø§Øª Ú©Ø§Ù…Ù„ Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª
- **CheckoutPage.example.tsx**: Ù†Ù…ÙˆÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø¯ÛŒ
- **INTEGRATION.md**: Ø§ÛŒÙ† ÙØ§ÛŒÙ„ (Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡â€ŒØ³Ø§Ø²ÛŒ)

Ù…ÙˆÙÙ‚ Ø¨Ø§Ø´ÛŒØ¯! ğŸš€
